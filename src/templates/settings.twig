{% requirePermission 'translated:settings' %}

{% macro configWarning(setting) -%}
    {{ 'This is being overridden by the `' ~ setting ~ ('` config setting.'|markdown(inlineOnly = true)) }}
{%- endmacro %}

{% from _self import configWarning %}

{% extends '_layouts/cp' %}
{% import '_includes/forms' as forms %}
{% set selectedSubnavItem = 'settings' %}
{% set title = 'Translated' %}

{% block tabs %}
    <header id="content-header" class="pane-header">
        <nav id="tabs" class="pane-tabs">
            <ul>
                <li data-id="0">
                    <a id="tab-0" class="tab sel" href="#tab-settings" title="Settings" aria-label="Settings">
                        Settings
                    </a>
                </li>
                <li data-id="1">
                    <a id="tab-1"
                        class="tab"
                        href="#tab-notifications"
                        title="Notifications"
                        aria-label="Notifications">
                        Notifications
                    </a>
                </li>
            </ul>
            <button type="button" id="overflow-tab-btn" data-icon="ellipsis" class="btn menubtn hidden"></button>
            <div id="overflow-tab-menu" class="menu">
                <ul role="listbox"></ul>
            </div>
        </nav>
    </header>
{% endblock %}

{% set content %}
    <div id="tab-settings">
        <form method="post">
            {{ csrfInput() }}
            <input type="hidden" name="action" value="translated/settings/save-plugin-settings" />

            {% namespace 'settings' %}
            {{
                forms.autosuggestField({
                    label: 'Translated username',
                    id: 'translatedUsername',
                    name: 'translatedUsername',
                    required: 'required',
                    value: settings['translatedUsername'],
                    suggestions: craft.cp.getEnvSuggestions(),
                    suggestEnvVars: true,
                    errors: settings.getErrors('translatedUsername')
                })
            }}

            {{
                forms.autosuggestField({
                    label: 'Translated password',
                    id: 'translatedPassword',
                    name: 'translatedPassword',
                    required: 'required',
                    value: settings['translatedPassword'],
                    suggestions: craft.cp.getEnvSuggestions(),
                    suggestEnvVars: true,
                    errors: settings.getErrors('translatedPassword')
                })
            }}

            {{
                forms.lightswitchField({
                    label: 'Translate slugs',
                    instructions: 'Send slugs to be translated from autogenerated orders. Slugs will be automatically updated along with the content when the returned translation order is synced to an entry.',
                    id: 'translateSlugs',
                    name: 'translateSlugs',
                    on: settings['translateSlugs'],
                    warning: config.translateSlugs is defined ? configWarning('translateSlugs')
                })
            }}

            {{
                forms.lightswitchField({
                    label: 'Sandbox mode',
                    instructions: 'The Sandbox mode allows developers to test the integration with the Translated service. Any files submitted with Sandbox mode enabled will not be translated and, therefore, no transaction will occur. Please note that the text supplied will not be translated, but returned in their original format. Response times will vary, between 30-120 seconds.',
                    id: 'translatedSandbox',
                    name: 'translatedSandbox',
                    on: settings['translatedSandbox'],
                    warning: config.translatedSandbox is defined ? configWarning('cachingEnabled')
                })
            }}

            {{
                forms.selectField({
                    label: 'Asset volume',
                    instructions: 'Every time a translation is requested, the Translated plugin will generate a CSV file which will be sent to the translation service. Please select a volume to store these files.',
                    id: 'translatedAutogenerationDirectory',
                    name: 'translatedAutogenerationDirectory',
                    options: assetOptions,
                    value: settings['translatedAutogenerationDirectory'],
                    errors: settings.getErrors('translatedAutogenerationDirectory')
                })
            }}

            {% endnamespace %}

            <input type="submit" class="submit btn" value="{{ 'Save'|t }}" />
        </form>
    </div>

    <div id="tab-notifications" class="hidden">
        <form method="post">
            {{ csrfInput() }}
            <input type="hidden" name="action" value="translated/settings/save-plugin-settings" />

            {% namespace 'settings' %}
            {{
                forms.lightswitchField({
                    label: 'Send notifications',
                    instructions: 'Send notifications when translation files are delivered',
                    id: 'translatedNotifications',
                    name: 'translatedNotifications',
                    on: settings['translatedNotifications'],
                    warning: config.translatedNotifications is defined ? configWarning('translatedNotifications')
                })
            }}
            {{
                forms.autosuggestField({
                    label: 'Notification email(s)',
                    instructions: 'Accepts comma seperated list for multiple notifyees',
                    id: 'translatedNotificationEmail',
                    name: 'translatedNotificationEmail',
                    value: settings['translatedNotificationEmail'],
                    warning: config.translatedNotificationEmail is defined
                        ? configWarning('translatedNotificationEmail')
                })
            }}
            {% endnamespace %}

            <input type="submit" class="submit btn" value="{{ 'Save'|t }}" />
        </form>
    </div>
{% endset %}
