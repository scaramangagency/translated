{% requirePermission 'translated:settings' %}

{% extends '_layouts/cp' %}
{% import '_includes/forms' as forms %}
{% set selectedSubnavItem = 'settings' %}
{% set title = 'Translated' %}

{% block tabs %}
    <nav id="tabs">
        <ul>
            <li data-id="0">
                <a id="tab-0" class="tab sel" href="#tab-settings" title="Settings" aria-label="Settings">Settings</a>
            </li>
            <li data-id="1">
                <a id="tab-1" class="tab" href="#tab-notifications" title="Notifications" aria-label="Notifications">
                    Notifications
                </a>
            </li>
        </ul>
        <button type="button" id="overflow-tab-btn" data-icon="ellipsis" class="btn menubtn hidden"></button>
        <div id="overflow-tab-menu" class="menu">
            <ul role="listbox"></ul>
        </div>
    </nav>
{% endblock %}

{% set content %}
    <div id="tab-settings">
        <form method="post">
            {{ csrfInput() }}
            <input type="hidden" name="action" value="translated/settings/save-plugin-settings" />

            {% namespace 'settings' %}
            {{
                forms.autosuggestField({
                    label: 'translated Username',
                    id: 'translatedUsername',
                    name: 'translatedUsername',
                    required: 'required',
                    value: settings['translatedUsername'],
                    suggestions: craft.cp.getEnvSuggestions(),
                    suggestEnvVars: true,
                    errors: settings.getErrors('translatedUsername')
                })
            }}

            {{
                forms.autosuggestField({
                    label: 'translated Password',
                    id: 'translatedPassword',
                    name: 'translatedPassword',
                    required: 'required',
                    value: settings['translatedPassword'],
                    suggestions: craft.cp.getEnvSuggestions(),
                    suggestEnvVars: true,
                    errors: settings.getErrors('translatedPassword')
                })
            }}

            {{
                forms.selectField({
                    label: 'Auto-generated asset directory',
                    instructions: 'What asset directory should autogenerated CSV files be pushed into? These will be automatically purged once the translation has been completed.',
                    id: 'translatedAutogenerationDirectory',
                    name: 'translatedAutogenerationDirectory',
                    options: assetOptions,
                    value: settings['translatedAutogenerationDirectory'],
                    errors: settings.getErrors('translatedAutogenerationDirectory')
                })
            }}

            {{
                forms.lightswitchField({
                    label: 'Clean up files',
                    instructions: "Delete files attached to translation order once translation has been fulfilled. This applies only to files you have manually uploaded. CSV's created through auto-generation are automatically purged.",
                    id: 'translatedCleanup',
                    name: 'translatedCleanup',
                    on: settings['translatedCleanup']
                })
            }}

            {{
                forms.lightswitchField({
                    label: 'Sandbox mode',
                    instructions: 'Submit test orders. The text of the delivered message will not be the translation, but the same text you sent with the quote. Expect deliveries in a random amount of time ranging between 30 seconds and 2 minutes.',
                    id: 'translatedSandbox',
                    name: 'translatedSandbox',
                    on: settings['translatedSandbox']
                })
            }}
            {% endnamespace %}

            <input type="submit" class="submit btn" value="{{ 'Save'|t }}" />
        </form>
    </div>

    <div id="tab-notifications" class="hidden">
        <form method="post">
            {{ csrfInput() }}
            <input type="hidden" name="action" value="translated/settings/save-plugin-settings" />

            {% namespace 'settings' %}
            {{
                forms.lightswitchField({
                    label: 'Send notifications',
                    instructions: 'Send notifications when translation files are delivered',
                    id: 'translatedNotifications',
                    name: 'translatedNotifications',
                    on: settings['translatedNotifications']
                })
            }}
            {{
                forms.autosuggestField({
                    label: 'Notification email(s)',
                    instructions: 'Accepts comma seperated list for multiple notifyees',
                    id: 'translatedNotificationEmail',
                    name: 'translatedNotificationEmail',
                    value: settings['translatedNotificationEmail']
                })
            }}
            {% endnamespace %}

            <input type="submit" class="submit btn" value="{{ 'Save'|t }}" />
        </form>
    </div>
{% endset %}
